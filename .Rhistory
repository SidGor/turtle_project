install.packages(“pryr")"
install.packages("pryr")
install.packages(knitr)
install.packages(rmarkdown)
install.packages("rmarkdown")
install.packages("knitr")
---
title: "All you need to know about environment"
output: pdf_document
---
library(pryr)
##Basic About Environment
library(pryr)
??rmarkdown
install.packages("rmarkdown")
install.packages("rmarkdown")
getwd()
setwd("E:/Github")
cdt<-readRDS(cdt.rds)
cdt<-readRDS("cdt.rds")
library(data.table)
cdt <- as.data.table(cdt)
sav_long  <- vector()
sav_short <- vector()
sig_long  <- vector()
sig_short <- vector()
product_ids          <- c("rb", "cu", "al")          ##########################
start_date           <- 20160601                     ##########  DATA  ########
end_date             <- 20161231                     ########  LOADING  #######
frequency            <- "day"                        ##########################
vm                   <- c(products$rb$volume_multiple,     #提取合约单位
products$cu$volume_multiple,
products$al$volume_multiple)
account              <- 100000000                          #初始账户资金
acc_origin           <- account   #当account大于这个数的时候就不用调整shadow
shadow_account       <- account   #判定Unit大小的账户资金，最大为初始资金
cash                 <- account   #初始现金
slippage             <- c(2*products$rb$price_tick,        #滑点读取
2*products$cu$price_tick,
2*products$al$price_tick)
fee.rate             <- c(products$rb$cost_ratio,        #手续费读取
products$cu$cost_ratio,
products$al$cost_ratio)
system.selection     <- 2  #choose sys1 or sys2            #采用哪个交易系统
position             <- rep(0,length(product_ids))         #表现持仓的数列
corr_mat             <- list(                       #两个判定风险的相关矩阵
clscorr = matrix(c(1,1,0,1,1,0,0,0,1),3,3,
dimnames = list(product_ids, product_ids)
),
lslcorr = matrix(c(1,0,0,0,1,0,0,0,1),3,3,
dimnames = list(product_ids, product_ids)
))
close_sys             <- NULL  #后面可以用这个控制使用什么平仓规则
data                  <- list()          #存储价格数据
trade_in              <- list()          #记录买入
trade_out             <- list()          #记录卖出
standing_contract     <- list()          #持仓记录
asset_sheet           <- list()          #资产记录
for (j in 1:length(product_ids)){     #extract the high,55high, low,55low
sav_long  <- append(sav_long,c(cdt[[4+(j-1)*15]][56],cdt[[15+(j-1)*15]][56]))#get the high and 55high
sav_short <- append(sav_short,c(cdt[[5+(j-1)*15]][56],cdt[[16+(j-1)*15]][56]))
}
for (j in 1:length(product_ids)){
sig_long[j]  <- sav_long[(2*j - 1)] >sav_long[2*j]
sig_short[j] <- sav_short[(2*j - 1)] < sav_short[2*j]
}
sig_long
sig_short
sig_long[1,3]
sig_long[1] =TRUE
sig_long[3] = TRUE
sig_short[2] = TRUE
NxDPPs <- rep(NA,length(product_ids))
for (j in 1:length(product_ids)){
NxDPPs[j] <- as.numeric(cdt[[15*j-5]][ptr])  #根据相对位置提取N*DPP以计算Unit限制
}
units <- 0.01*shadow_account/NxDPPs             #当前每个产品下的Unit
units <- floor(units)
NxDPPs <- rep(NA,length(product_ids))
for (j in 1:length(product_ids)){
NxDPPs[j] <- as.numeric(cdt[[15*j-5]][56])  #根据相对位置提取N*DPP以计算Unit限制
}
units <- 0.01*shadow_account/NxDPPs             #当前每个产品下的Unit
units <- floor(units)
PTR = 56
ptr = 56
PTR = NULL
units
units*sig_long
for (j from 1:length(product_ids)){
if sig_long[j] == 0 next()
print(sig_long[j])
}#开仓loop
for (j from 1:length(product_ids)){
if sig_long[j] == 0 next
print(sig_long[j])
}#开仓loop
for (j from 1:length(product_ids)){
if sig_long[j] == 0 {next}
else{
print(sig_long[j])}
}#开仓loop
for (j from 1:length(product_ids)){
if sig_long[j] == 0 {next}
else{
print(sig_long[j])
}#开仓loop
for (j from 1:length(product_ids)){
if (sig_long[j] == 0) {next}
else{
print(sig_long[j])
}
}#开仓loop
for (j from 1:length(product_ids)){
if (sig_long[j] == 0) {next}
{
print(sig_long[j])
}
}#开仓loop
for (j from 1:length(product_ids)){
if (sig_long[j] == 0) next
print(sig_long[j])
}
for (j from 1:length(product_ids)){
if (sig_long[j] == 0) {next()}
else{
print(sig_long[j])
}
}#开仓loop
for (j from 1:length(product_ids)){
if (sig_long[j] == 0) {
next()
}else{
print(sig_long[j])
}
}#开仓loop
for (j from 1:length(product_ids)){
if (sig_long[j] == 0) {
0
}else{
print(sig_long[j])
}
}#开仓loop
sig_long
long_plan <- sig_long * units
for (j from 1:length(product_ids)){
if (long_plan[j] *units == 0) {
0
}else{
print(sig_long[j])
}
}#开仓loop
long_plan <- sig_long * units
long_plan[1]
long_plan[1] == 0
for (j from 1:length(product_ids)){
if (long_plan[j] == 0) next
print(long_plan[j])
}#开仓loop
for (j from 1:length(product_ids)){
if (long_plan[j] == 0) next
if (TRUE) {print(long_plan[j])}
}#开仓loop
for (j from 1:length(product_ids)){
if (long_plan[j] == 0) next
}#开仓loop
for (j from 1:length(product_ids)) {1}
for (j in 1:length(product_ids)){
if (long_plan[j] == 0) next
print(long_plan[j])
}#开仓loop
t_position = copy(position)
corr_mat
t_position %*% corr_mat$clscorr
t_position[j] = long_plan[j]
t_position > 4*units
t_position
position
t_position = copy(position)
j = 1
t_position[j] = long_plan[j]
t_position
t_position > 4*units
4*units
units
t_position %*% corr_mat$clscorr
6*units
any(t_position %*% corr_mat$clscorr > 6*units
)
long_plan
t_position = copy(position)
t_position[j] = long_plan[j]/units[j]
t_position
t_position %*% corr_mat$clscorr
sum(t_position)
test <- (1,2,3,4,10,10,10)
test <- c(1,2,3,4,10,10,10)
sum(test)
t_position
t_position[2] = -1
abs(t_position)
t_position[2] = 0
any(abs(t_position %*% corr_mat$lslcorr) > 10)
abs(t_position %*% corr_mat$lslcorr
)
t_position
long_plan
holding              <- rep(0,length(product_ids))         #表现持仓合约的数列
long_plan <- sig_long * units  #the aggregate plan of how many *contracts(not tons)* should be add
t_position = copy(position)#建立测试仓位用的向量
for (j in 1:length(product_ids)){
if (long_plan[j] == 0) next  #节省运算时间
t_position[j] = (t_position[j] + long_plan[j])/units[j]
#test 1: any direction ,single holding should be less than 4
if (any(abs(t_position) > 4)) {
#test 2: any direction, combination of strong corr assets should be less than 6
}else if (any(abs(t_position %*% corr_mat$clscorr) > 6)){
#test 3: any direction, combination of losely corr assets should be less than 10
}else if (any(abs(t_position %*% corr_mat$lslcorr) > 10)){
#test 4: any direction, total holding should be less than 12
}else if (abs(sum(t_position)) > 12){
}else {
position[j] <- t_position[j]
holding[j] <- holding[j] + long_plan[j]
}
}#开仓loop
position
holding
cdt[1]
cdt[,25]
cdt[,24]
cdt[,39]
cdt[,5]
cdt[,6]
cdt[,9]
